/*! restie - v0.1.1 - 2012-05-06
* Copyright (c) 2012 Vadim Demedes; Licensed MIT */

if (!(typeof window !== "undefined" && window !== null)) { global.window = {}; }
if(typeof window=="undefined"||window===null)global.window={};window&&!window.InflectionJS&&(window.InflectionJS=null),InflectionJS={uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news"],plural_rules:[[new RegExp("(m)an$","gi"),"$1en"],[new RegExp("(pe)rson$","gi"),"$1ople"],[new RegExp("(child)$","gi"),"$1ren"],[new RegExp("^(ox)$","gi"),"$1en"],[new RegExp("(ax|test)is$","gi"),"$1es"],[new RegExp("(octop|vir)us$","gi"),"$1i"],[new RegExp("(alias|status)$","gi"),"$1es"],[new RegExp("(bu)s$","gi"),"$1ses"],[new RegExp("(buffal|tomat|potat)o$","gi"),"$1oes"],[new RegExp("([ti])um$","gi"),"$1a"],[new RegExp("sis$","gi"),"ses"],[new RegExp("(?:([^f])fe|([lr])f)$","gi"),"$1$2ves"],[new RegExp("(hive)$","gi"),"$1s"],[new RegExp("([^aeiouy]|qu)y$","gi"),"$1ies"],[new RegExp("(x|ch|ss|sh)$","gi"),"$1es"],[new RegExp("(matr|vert|ind)ix|ex$","gi"),"$1ices"],[new RegExp("([m|l])ouse$","gi"),"$1ice"],[new RegExp("(quiz)$","gi"),"$1zes"],[new RegExp("s$","gi"),"s"],[new RegExp("$","gi"),"s"]],singular_rules:[[new RegExp("(m)en$","gi"),"$1an"],[new RegExp("(pe)ople$","gi"),"$1rson"],[new RegExp("(child)ren$","gi"),"$1"],[new RegExp("([ti])a$","gi"),"$1um"],[new RegExp("((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$","gi"),"$1$2sis"],[new RegExp("(hive)s$","gi"),"$1"],[new RegExp("(tive)s$","gi"),"$1"],[new RegExp("(curve)s$","gi"),"$1"],[new RegExp("([lr])ves$","gi"),"$1f"],[new RegExp("([^fo])ves$","gi"),"$1fe"],[new RegExp("([^aeiouy]|qu)ies$","gi"),"$1y"],[new RegExp("(s)eries$","gi"),"$1eries"],[new RegExp("(m)ovies$","gi"),"$1ovie"],[new RegExp("(x|ch|ss|sh)es$","gi"),"$1"],[new RegExp("([m|l])ice$","gi"),"$1ouse"],[new RegExp("(bus)es$","gi"),"$1"],[new RegExp("(o)es$","gi"),"$1"],[new RegExp("(shoe)s$","gi"),"$1"],[new RegExp("(cris|ax|test)es$","gi"),"$1is"],[new RegExp("(octop|vir)i$","gi"),"$1us"],[new RegExp("(alias|status)es$","gi"),"$1"],[new RegExp("^(ox)en","gi"),"$1"],[new RegExp("(vert|ind)ices$","gi"),"$1ex"],[new RegExp("(matr)ices$","gi"),"$1ix"],[new RegExp("(quiz)zes$","gi"),"$1"],[new RegExp("s$","gi"),""]],non_titlecased_words:["and","or","nor","a","an","the","so","but","to","of","at","by","from","into","on","onto","off","out","in","over","with","for"],id_suffix:new RegExp("(_ids|_id)$","g"),underbar:new RegExp("_","g"),space_or_underbar:new RegExp("[ _]","g"),uppercase:new RegExp("([A-Z])","g"),underbar_prefix:new RegExp("^_"),apply_rules:function(a,b,c,d){if(d)a=d;else{var e=c.indexOf(a.toLowerCase())>-1;if(!e)for(var f=0;f<b.length;f++)if(a.match(b[f][0])){a=a.replace(b[f][0],b[f][1]);break}}return a}},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b,c){b||(b=-1);var d=-1;for(var e=b;e<this.length;e++)if(this[e]===a||c&&c(this[e],a)){d=e;break}return d}),String.prototype._uncountable_words||(String.prototype._uncountable_words=InflectionJS.uncountable_words),String.prototype._plural_rules||(String.prototype._plural_rules=InflectionJS.plural_rules),String.prototype._singular_rules||(String.prototype._singular_rules=InflectionJS.singular_rules),String.prototype._non_titlecased_words||(String.prototype._non_titlecased_words=InflectionJS.non_titlecased_words),String.prototype.pluralize||(String.prototype.pluralize=function(a){return InflectionJS.apply_rules(this,this._plural_rules,this._uncountable_words,a)}),String.prototype.singularize||(String.prototype.singularize=function(a){return InflectionJS.apply_rules(this,this._singular_rules,this._uncountable_words,a)}),String.prototype.camelize||(String.prototype.camelize=function(a){var b=this.toLowerCase(),c=b.split("/");for(var d=0;d<c.length;d++){var e=c[d].split("_"),f=a&&d+1===c.length?1:0;for(var g=f;g<e.length;g++)e[g]=e[g].charAt(0).toUpperCase()+e[g].substring(1);c[d]=e.join("")}return b=c.join("::"),b}),String.prototype.underscore||(String.prototype.underscore=function(){var a=this,b=a.split("::");for(var c=0;c<b.length;c++)b[c]=b[c].replace(InflectionJS.uppercase,"_$1"),b[c]=b[c].replace(InflectionJS.underbar_prefix,"");return a=b.join("/").toLowerCase(),a}),String.prototype.humanize||(String.prototype.humanize=function(a){var b=this.toLowerCase();return b=b.replace(InflectionJS.id_suffix,""),b=b.replace(InflectionJS.underbar," "),a||(b=b.capitalize()),b}),String.prototype.capitalize||(String.prototype.capitalize=function(){var a=this.toLowerCase();return a=a.substring(0,1).toUpperCase()+a.substring(1),a}),String.prototype.dasherize||(String.prototype.dasherize=function(){var a=this;return a=a.replace(InflectionJS.space_or_underbar,"-"),a}),String.prototype.titleize||(String.prototype.titleize=function(){var a=this.toLowerCase();a=a.replace(InflectionJS.underbar," ");var b=a.split(" ");for(var c=0;c<b.length;c++){var d=b[c].split("-");for(var e=0;e<d.length;e++)this._non_titlecased_words.indexOf(d[e].toLowerCase())<0&&(d[e]=d[e].capitalize());b[c]=d.join("-")}return a=b.join(" "),a=a.substring(0,1).toUpperCase()+a.substring(1),a}),String.prototype.demodulize||(String.prototype.demodulize=function(){var a=this,b=a.split("::");return a=b[b.length-1],a}),String.prototype.tableize||(String.prototype.tableize=function(){var a=this;return a=a.underscore().pluralize(),a}),String.prototype.classify||(String.prototype.classify=function(){var a=this;return a=a.camelize().singularize(),a}),String.prototype.foreign_key||(String.prototype.foreign_key=function(a){var b=this;return b=b.demodulize().underscore()+(a?"":"_")+"id",b}),String.prototype.ordinalize||(String.prototype.ordinalize=function(){var a=this,b=a.split(" ");for(var c=0;c<b.length;c++){var d=parseInt(b[c]);if(d===NaN){var e=b[c].substring(b[c].length-2),f=b[c].substring(b[c].length-1),g="th";e!="11"&&e!="12"&&e!="13"&&(f==="1"?g="st":f==="2"?g="nd":f==="3"&&(g="rd")),b[c]+=g}}return a=b.join(" "),a});var jQueryRequestAdapter;jQueryRequestAdapter=function(){function a(){}return a.name="jQueryRequestAdapter",a.prototype.request=function(a,b){var c;if(a.method==="GET")for(c in a.form)a.qs[c]&&a.qs[c]===a.form[c]&&delete a.qs[c];return $.ajax({url:""+a.url+"?"+$.param(a.qs),data:a.form,type:a.method,headers:a.headers,complete:function(a){return b(!1,{statusCode:a.status,body:a.responseText},a.responseText)}})},a}();var NodejsRequestAdapter;NodejsRequestAdapter=function(){function a(){this.request=require("request")}return a.name="NodejsRequestAdapter",a}();var Model,Restie,bakeModels,setRequestOptions;Function.prototype.clone=function(){var a,b;a=function(){};for(b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a.prototype=this.prototype,a},Restie=function(){function a(){}return a.name="Restie",a.set=function(a){var b,c;a==null&&(a={}),this.options||(this.options={}),c=[];for(b in a)c.push(this.options[b]=a[b]);return c},a.define=function(a,b){var c,d,e;d=Model.clone(),d.prototype.resourceName=d.resourceName=a.pluralize().toLowerCase(),d.prototype.options=d.options={},e=b.primaryKey||"id",d["find_by_"+b.primaryKey.underscore()]=d["findBy"+b.primaryKey.camelize()]=d.findByPrimaryKey;for(c in this.options)d.prototype.options[c]=d.options[c]=this.options[c];return d.prototype.model=d.model=d,d},a}(),setRequestOptions=function(a,b){var c,d,e;b.headers||(b.headers={}),b.form||(b.form={}),b.qs=b.params?b.params:{};if(a.defaults){if(a.defaults.headers)for(d in a.defaults.headers)b.headers[d]=a.defaults.headers[d];if(a.defaults.fields)for(c in a.defaults.fields)b.form[c]=a.defaults.fields[c];if(a.defaults.params)for(e in a.defaults.params)b.qs[e]=a.defaults.params[e]}return b},bakeModels=function(a,b){var c,d,e,f,g,h;f=[];for(g=0,h=a.length;g<h;g++){c=a[g],e=new b;for(d in c)e[d]=c[d];f.push(e)}return f},Model=function(){function a(a){var b;for(b in a)this[b]=a[b]}return a.name="Model",a.set=function(a){var b,c;a==null&&(a={}),this.options||(this.options={}),c=[];for(b in a)c.push(this.options[b]=a[b]);return c},a.bakeModels=function(a){return bakeModels(a,this.model)},a.prototype.bakeModels=function(a){return bakeModels(a,this.model)},a.prototype.setRequestOptions=function(a){return setRequestOptions(this.options,a)},a.setRequestOptions=function(a){return setRequestOptions(this.options,a)},a.all=function(a){var b,c;return b={url:""+this.options.urls.base+"/"+this.resourceName,method:"GET"},b=this.setRequestOptions(b),c=this,Restie.adapter.request(b,function(b,d,e){return d.statusCode===200?a(!1,c.bakeModels(JSON.parse(e))):a(d,[])})},a.findByPrimaryKey=function(a,b){var c,d,e;return c=this.options.primaryKey||"id",d={url:""+this.options.urls.base+"/"+this.resourceName+"/"+a,method:"GET"},d=this.setRequestOptions(d),e=this,Restie.adapter.request(d,function(a,c,d){return c.statusCode===200?b(!1,e.bakeModels([JSON.parse(d)])[0]):b(c,{})})},a.create=function(a,b){var c,d;d=new this.model;for(c in a)d[c]=a[c];return d.save(b)},a.prototype.save=function(a){var b,c,d,e,f;b={};for(c in this)this.hasOwnProperty(c)&&(b[c]=this[c]);return e={url:""+this.options.urls.base+"/"+this.resourceName,method:"POST"},this.options.wrapFields?(c=this.resourceName.singularize(),e.form={key:b}):e.form=b,d=this.options.primaryKey||"id",b[d]&&(e.url+="/"+b[d],e.method="POST",e.form._method="PUT"),e=this.setRequestOptions(e),f=this,Restie.adapter.request(e,function(b,c,e){return c.statusCode===201||c.statusCode===200?(e=JSON.parse(e),f[d]=e[d],a(!1,f.bakeModels([e])[0])):a(c)})},a.prototype.remove=function(a){var b,c;return b=this.options.primaryKey||"id",c={url:""+this.options.urls.base+"/"+this.resourceName+"/"+this[b],method:"POST",form:{_method:"DELETE"}},c=this.setRequestOptions(c),Restie.adapter.request(c,function(b,c){return c.statusCode===200?a(!1):a(c)})},a}(),window.location!=null?(Restie.env="browser",Restie.adapter=new jQueryRequestAdapter,Restie.set({urls:{base:window.location.host}}),window.Restie=Restie):(Restie.env="nodejs",Restie.adapter=new NodejsRequestAdapter,module.exports=Restie);